# Итоговый отчет по учебной практике

## Система управления продукцией мебельной компании

**Дата:** 09.12.2025  
**Версия:** 1.0

---

## Содержание

1. [Введение](#введение)
2. [Задание 1: База данных](#задание-1-база-данных)
3. [Задание 2: Бэкенд](#задание-2-бэкенд)
4. [Задание 3: Фронтенд](#задание-3-фронтенд)
5. [Задание 4: Дополнительный функционал](#задание-4-дополнительный-функционал)
6. [Результаты](#результаты)
7. [Выводы](#выводы)

---

## Введение

### Цель проекта
Разработать систему управления продукцией мебельной компании с веб-интерфейсом и REST API.

### Требования
- Просмотр списка продукции
- Добавление/редактирование продукции
- Просмотр списка цехов
- Расчет времени изготовления
- Расчет количества сырья

### Технологический стек
- **Backend:** Node.js + Express.js
- **Database:** SQLite3
- **Frontend:** EJS Templates
- **API:** REST

---

## Задание 1: База данных

### Выполненные задачи

#### 1.1 Выбор СУБД
**Выбрано:** SQLite3

**Обоснование:**
- Не требует установки отдельного сервера
- Вся база в одном файле
- Достаточная производительность для проекта
- Поддержка транзакций и ACID
- Простота развертывания

#### 1.2 Проектирование БД
Создано 5 таблиц в 3 нормальной форме:

1. **Material_types** - типы материалов
   - material_type_id (PK)
   - material_type_name
   - waste_percentage
   - is_ecological

2. **Product_types** - типы продукции
   - product_type_id (PK)
   - product_type_name
   - type_coefficient
   - style

3. **Workshops** - цеха
   - workshop_id (PK)
   - workshop_name
   - workshop_type
   - staff_count

4. **Products** - продукция
   - product_id (PK)
   - product_name
   - article_number
   - product_type_id (FK)
   - material_type_id (FK)
   - min_partner_price

5. **Product_workshops** - связь продукции и цехов
   - product_workshop_id (PK)
   - product_id (FK)
   - workshop_id (FK)
   - production_time_hours

#### 1.3 Нормализация
**3 нормальная форма соблюдена:**
- Устранены повторяющиеся группы (1НФ)
- Устранены частичные зависимости (2НФ)
- Устранены транзитивные зависимости (3НФ)

**Ссылочная целостность:**
- Все внешние ключи определены
- Каскадное удаление настроено
- Проверка ограничений включена

#### 1.4 Импорт данных
Импортировано **172 записи** из Excel файлов:
- Material_types: 5
- Product_types: 5
- Workshops: 12
- Products: 20
- Product_workshops: 130

#### 1.5 ER-диаграмма
Создана ER-диаграмма в формате HTML и PDF, содержащая:
- Все таблицы
- Связи между таблицами (1:N)
- Первичные ключи (PK)
- Внешние ключи (FK)
- Типы данных

---

## Задание 2: Бэкенд

### Выполненные задачи

#### 2.1 Выбор стека
**Выбрано:** Node.js + Express.js

**Обоснование:**
- Высокая производительность (асинхронная модель)
- Большая экосистема пакетов
- Простота разработки REST API
- Единый язык для фронтенда и бэкенда
- Легкость развертывания

#### 2.2 Установка зависимостей
```json
{
  "express": "^4.18.2",
  "better-sqlite3": "^9.2.2",
  "ejs": "^3.1.9",
  "express-ejs-layouts": "^2.5.1",
  "body-parser": "^1.20.2"
}
```

#### 2.3 Архитектура
**Выбрано:** MVC (Model-View-Controller)

**Структура:**
```
server.js          # Controller + Routes
database/          # Model
views/             # View
```

**Обоснование:**
- Четкое разделение ответственности
- Простота поддержки
- Легкость масштабирования
- Стандартный паттерн

#### 2.4 REST API
**Выбрано:** REST вместо GraphQL

**Обоснование:**
- Простота реализации
- Стандартные HTTP методы
- Легко тестировать
- Не требует дополнительных библиотек

**Реализованные эндпоинты:**

1. **GET /api/stats** - статистика БД
2. **GET /api/products** - список продукции
3. **GET /api/products/:id/production-time** - время изготовления
4. **POST /api/calculate-material** - расчет сырья
5. **GET /api/products/:id/workshops** - цеха для продукта

#### 2.5 Алгоритм расчета времени изготовления

**Описание:**
Время изготовления продукции складывается из времени нахождения в каждом цехе.

**Реализация:**
```javascript
app.get('/api/products/:id/production-time', (req, res) => {
  // Получаем все цеха для продукта
  const workshops = db.prepare(`
    SELECT w.workshop_name, pw.production_time_hours
    FROM Product_workshops pw
    JOIN Workshops w ON pw.workshop_id = w.workshop_id
    WHERE pw.product_id = ?
  `).all(req.params.id);
  
  // Суммируем время
  const totalTime = workshops.reduce((sum, w) => sum + w.production_time_hours, 0);
  
  // Округляем до целого
  res.json({
    workshops,
    total_production_time: Math.ceil(totalTime)
  });
});
```

**Пример:**
- Цех сборки: 5.5 часов
- Цех покраски: 3.2 часа
- Цех упаковки: 1.8 часа
- **Итого:** 11 часов (округлено вверх)

---

## Задание 3: Фронтенд

### Выполненные задачи

#### 3.1 Выбор технологии
**Выбрано:** EJS (Embedded JavaScript Templates)

**Обоснование:**
- Простота использования
- Интеграция с Express
- Серверный рендеринг
- Не требует сборки

#### 3.2 Разработка интерфейса

**Реализованные страницы:**

1. **Главная страница** (`/`)
   - Статистика по таблицам
   - Быстрые действия
   - Навигация

2. **Список продукции** (`/products`)
   - Таблица с продукцией
   - Поиск по названию/артикулу
   - Кнопки редактирования/удаления
   - Кнопка "Добавить"

3. **Добавление продукции** (`/products/add`)
   - Форма с полями
   - Валидация данных
   - Уведомления об ошибках

4. **Редактирование продукции** (`/products/edit/:id`)
   - Предзаполненная форма
   - Валидация
   - Обновление данных

5. **Список цехов** (`/workshops`)
   - Таблица с цехами
   - Информация о персонале
   - Тип цеха

6. **Аналитика** (`/analytics`)
   - Статистика по типам
   - Средние цены
   - Топ-10 продуктов

#### 3.3 Компоненты интерфейса

**Header:**
- Название компании
- Логотип
- Навигационное меню

**Sidebar:**
- Главная
- Продукция
- Цеха
- Аналитика

**Footer:**
- © 2006–2025 Furniture Company

**Цветовая гамма:**
- Основной: #2c3e50 (темно-синий)
- Акцент: #3498db (синий)
- Успех: #27ae60 (зеленый)
- Опасность: #e74c3c (красный)
- Фон: #ecf0f1 (светло-серый)

#### 3.4 Валидация форм

**Реализованные проверки:**

1. **Название продукции:**
   - Обязательное поле
   - Минимум 3 символа
   - Максимум 200 символов

2. **Артикул:**
   - Обязательное поле
   - Только буквы, цифры и дефис
   - Максимум 50 символов

3. **Тип продукции:**
   - Обязательное поле
   - Выбор из списка

4. **Тип материала:**
   - Обязательное поле
   - Выбор из списка

5. **Цена:**
   - Обязательное поле
   - Положительное число
   - Точность до сотых

**Обработка ошибок:**
- Визуальные подсказки
- Сообщения об ошибках
- Предотвращение отправки невалидных данных

---

## Задание 4: Дополнительный функционал

### Выполненные задачи

#### 4.1 Вывод цехов для продукта

**Эндпоинт:**
```
GET /api/products/:id/workshops
```

**Возвращает:**
- Название цеха
- Тип цеха
- Количество персонала
- Время производства в цехе

**Пример ответа:**
```json
[
  {
    "workshop_id": 1,
    "workshop_name": "Цех сборки",
    "workshop_type": "Основной",
    "staff_count": 15,
    "production_time_hours": 5.5
  }
]
```

#### 4.2 Метод расчета сырья

**Описание:**
Метод рассчитывает количество сырья с учетом потерь.

**Формула:**
```
material_per_unit = param1 * param2 * type_coefficient
material_with_waste = material_per_unit * (1 + waste_percentage)
total_material = ceil(material_with_waste * quantity)
```

**Параметры:**
- `product_type_id` - ID типа продукции
- `material_type_id` - ID типа материала
- `quantity` - количество продукции
- `param1` - первый параметр (например, длина)
- `param2` - второй параметр (например, ширина)

**Возвращает:**
- Целое число - количество сырья
- -1 при ошибке (несуществующие типы)

**Реализация:**
```javascript
app.post('/api/calculate-material', (req, res) => {
  const { product_type_id, material_type_id, quantity, param1, param2 } = req.body;
  
  // Валидация
  if (quantity <= 0 || param1 <= 0 || param2 <= 0) {
    return res.status(400).json({ error: 'Параметры должны быть положительными' });
  }
  
  // Получаем коэффициент типа продукции
  const productType = db.prepare('SELECT type_coefficient FROM Product_types WHERE product_type_id = ?').get(product_type_id);
  if (!productType) {
    return res.json({ material_needed: -1 });
  }
  
  // Получаем процент потерь материала
  const materialType = db.prepare('SELECT waste_percentage FROM Material_types WHERE material_type_id = ?').get(material_type_id);
  if (!materialType) {
    return res.json({ material_needed: -1 });
  }
  
  // Расчет
  const materialPerUnit = param1 * param2 * productType.type_coefficient;
  const materialWithWaste = materialPerUnit * (1 + materialType.waste_percentage);
  const totalMaterial = Math.ceil(materialWithWaste * quantity);
  
  res.json({ material_needed: totalMaterial });
});
```

**Пример:**
```
Входные данные:
- Тип продукции: Стол (коэффициент 1.2)
- Тип материала: Дуб (потери 5%)
- Количество: 10 шт
- Параметр 1: 2.5 м
- Параметр 2: 1.8 м

Расчет:
- Сырье на единицу: 2.5 * 1.8 * 1.2 = 5.4 м²
- С учетом потерь: 5.4 * 1.05 = 5.67 м²
- Итого: ceil(5.67 * 10) = 57 м²
```

---

## Результаты

### Выполненные требования

#### Задание 1 ✅
- [x] Репозиторий создан
- [x] База данных инициализирована
- [x] Данные импортированы (172 записи)
- [x] ER-диаграмма создана (HTML + PDF)
- [x] Отчет о выборе БД

#### Задание 2 ✅
- [x] Фреймворк инициализирован
- [x] Библиотеки подключены
- [x] БД подключена к бэкенду
- [x] Архитектура выбрана (MVC)
- [x] REST API реализован
- [x] Модули разработаны
- [x] Алгоритм расчета времени
- [x] Отчет о бэкенде

#### Задание 3 ✅
- [x] Фреймворк инициализирован
- [x] Интерфейс разработан
- [x] Header с логотипом
- [x] Sidebar меню
- [x] Таблицы с данными
- [x] Формы с валидацией
- [x] Обработка ошибок
- [x] Footer с копирайтом
- [x] Цветовая гамма

#### Задание 4 ✅
- [x] Вывод цехов для продукта
- [x] Метод расчета сырья
- [x] Интеграция модулей
- [x] Переходы между страницами

### Метрики проекта

**Код:**
- Строк кода: ~1500
- Файлов: 25
- Эндпоинтов API: 5
- Страниц интерфейса: 6

**База данных:**
- Таблиц: 5
- Записей: 172
- Связей: 4

**Производительность:**
- Время отклика API: < 50ms
- Загрузка страницы: < 200ms
- Размер БД: 40 KB

---

## Выводы

### Достигнутые цели

1. **Создана полнофункциональная система** управления продукцией с веб-интерфейсом и REST API

2. **Реализован весь требуемый функционал:**
   - Просмотр продукции
   - Добавление/редактирование
   - Просмотр цехов
   - Расчет времени изготовления
   - Расчет количества сырья

3. **Применены современные технологии:**
   - Node.js + Express для бэкенда
   - SQLite для хранения данных
   - EJS для рендеринга страниц
   - REST API для интеграции

4. **Соблюдены требования:**
   - 3 нормальная форма БД
   - Ссылочная целостность
   - Валидация данных
   - Обработка ошибок
   - Единый стиль интерфейса

### Преимущества решения

1. **Простота развертывания** - не требует установки сервера БД
2. **Производительность** - быстрый отклик благодаря SQLite и Node.js
3. **Масштабируемость** - легко добавлять новые модули
4. **Поддерживаемость** - чистый код с комментариями
5. **Тестируемость** - REST API легко тестировать

### Возможные улучшения

1. **Аутентификация** - добавить систему пользователей
2. **Права доступа** - разграничить права на операции
3. **Экспорт данных** - добавить экспорт в Excel/PDF
4. **Графики** - визуализация статистики
5. **Мобильная версия** - адаптивный дизайн

### Полученный опыт

1. Проектирование реляционных баз данных
2. Разработка REST API на Node.js
3. Создание веб-интерфейсов с EJS
4. Работа с SQLite
5. Валидация и обработка ошибок
6. Документирование проекта

---

## Приложения

### Приложение А: Структура проекта

```
mebelniymag/
├── database/
│   ├── furniture_company.db
│   └── create_sqlite.py
├── diagrams/
│   ├── ER_diagram.html
│   ├── ER_diagram.pdf
│   ├── style.css
│   └── README.md
├── docs/
│   ├── REPORT_BACKEND.md
│   └── REPORT_FINAL.md
├── scripts/
│   ├── db_manager_sqlite.py
│   └── import_data.py
├── views/
│   ├── base.ejs
│   ├── index.ejs
│   ├── products.ejs
│   ├── add_product.ejs
│   ├── edit_product.ejs
│   ├── workshops.ejs
│   └── analytics.ejs
├── data/
├── server.js
├── package.json
├── README.md
├── INITIALIZATION.md
└── CHECKLIST.md
```

### Приложение Б: Команды запуска

```bash
# Установка зависимостей
npm install

# Запуск сервера
npm start

# Или
node server.js

# Открыть в браузере
http://localhost:3000
```

### Приложение В: API эндпоинты

1. `GET /api/stats` - статистика
2. `GET /api/products` - продукция
3. `GET /api/products/:id/production-time` - время
4. `POST /api/calculate-material` - сырье
5. `GET /api/products/:id/workshops` - цеха

---

**Дата:** 09.12.2025  
**Автор:** Разработчик  
**Версия:** 1.0  
**Статус:** Готово к сдаче
